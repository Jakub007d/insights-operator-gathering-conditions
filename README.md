# Insights Operator Remote Configuration

This repository contains remote configuration that the [Insights Operator Gathering Conditions Service](https://github.com/redhatinsights/insights-operator-gathering-conditions-service) serves to Insights Operators from connected OCP clusters. The remote configuration has two parts:

* Conditional gathering rules (`conditions/*`) for the alert-based [conditional gathering](https://github.com/openshift/insights-operator/blob/master/docs/conditional-gatherer/README.md). This feature has been introduced in OCP 4.9.0 and extended in later versions (see [gathered data](https://github.com/openshift/insights-operator/blob/master/docs/gathered-data.md) documentation for details).
* Data requests (`remote_configurations/*`) for the [Rapid Recommendations](https://github.com/openshift/enhancements/blob/master/enhancements/insights/rapid-recommendations.md) features. This feature has been introduced in OCP 4.17.0. It supports [container log requests](https://github.com/openshift/insights-operator/blob/master/docs/gathered-data.md#containerslogs) at the moment.

The repository contains source files for the remote configuration. The files required by the [Insights Operator Gathering Conditions Service](https://github.com/redhatinsights/insights-operator-gathering-conditions-service) are generated by the [build.sh](https://github.com/RedHatInsights/insights-operator-gathering-conditions/blob/main/build.sh) script.

## Build

```shell script
git clone https://github.com/RedHatInsights/insights-operator-gathering-conditions
cd insights-operator-gathering-conditions
# the build.sh script needs version tags
git fetch -p upstream
/bin/bash build.sh
```

## Generated Files

The `build.sh` script creates the following files:

```
build/
    v1/
        rules.json
    v2/
        *.json
```

`build/v1/rules.json` is the remote configuration for OCP 4.16 and older. It contains only the conditional gathering rules.

`build/v2/*.json` and [cluster-mapping.json](https://github.com/RedHatInsights/insights-operator-gathering-conditions-service/blob/main/cluster-mapping.json) comprise the remote configuration for OCP 4.17 and newer. The `cluster-mapping.json` file provides a mapping between OCP version ranges and `build/v2/*.json` files. Each `build/v2/*.json` file contains conditional gathering rules and container log requests for OCP versions defined in the `cluster-mapping.json` file.
